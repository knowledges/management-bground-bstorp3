<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="数据统计后台管理">
	<meta name="author" content="邱宝林">
	<title>瀑布流</title>
	<!-- 新 Bootstrap 核心 CSS 文件 -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
	<!--[if IE 7]>
		<link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css">
	<![endif]-->

	<link rel="stylesheet" href="css/xx-admin.css">

	<!-- 可选的Bootstrap主题文件（一般不用引入） -->
	<link rel="stylesheet" href="css/bootstrap-theme.min.css">
	
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
</head>
<body>
	<div class="page-warpper"  id="fall-page">
		<div class="container-fluid falls-div clearfix" id="falls">
			<div class="thumbnail">
				<img src="images/0.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/1.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/2.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/3.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/4.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/5.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/6.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/7.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/8.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/9.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/10.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/11.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/12.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/13.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/14.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/15.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/16.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/17.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/18.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/19.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/20.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/21.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
			<div class="thumbnail">
				<img src="images/22.jpg" alt="">
				<div class="caption">
				    <h3>Thumbnail label</h3>
				    <p>...</p>
				    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
				</div>
			</div>
		</div>
	</div>
	<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
	<script src="js/jquery-1.10.2.js"></script>
	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="js/bootstrap.min.js"></script>

	<script>
		$(function(){
			
			window.onload = function (){
				var dataInt = {"data":[{"src":"0.jpg"},{"src":"1.jpg"},{"src":"2.jpg"},{"src":"3.jpg"},{"src":"4.jpg"}]};
				init();
				window.onscroll = function(){
					if (checkScrollSlide()) {
						var html = [];
						$.each(dataInt.data, function(i, elem) {
							html.push('<div class="thumbnail">');
							html.push('<img src="images/'+elem.src+'" alt="">');
							html.push('</div>');
						});
						$("#falls").append(html.join(''));
						init();
					}
				}
			}
			
			function init(){
				//获取所有 ‘thumbnail’ 元素
				var thumbnails = $("#falls").find('div[class="thumbnail"]');
				//页面宽度
				var pageWidth = $("#fall-page").outerWidth();
				// 一个 box 的 宽度 
				var oboxs = thumbnails.eq(0).outerWidth(true);
				// 一列显示几个
				var oboxsCount = Math.floor(pageWidth/oboxs);
				var lMargin = (pageWidth - oboxsCount*oboxs) / 2 ;
				// 设置 falls 的宽度 再居中
				$("#falls").css({
					"width":oboxsCount*oboxs+"px",
					"padding":"0 0",
					"margin":"0 auto"
				});
				
				// 存放每一列高度的数组
				var hArr = [];
				for (var i = 0; i < thumbnails.length; i++) {
					if (i<oboxsCount) {
						hArr.push(thumbnails.eq(i).outerHeight(true));
					}else{
						// 获取最小值
						var hmin = Math.min.apply(null,hArr);
						// 获取最小值的索引
						var index = getMinhIndex(hArr, hmin);
						thumbnails.eq(i).css({
							position: 'absolute',
							top:hmin+"px",
							left:  (parseInt(index) * oboxs +lMargin)+"px"
						});
						hArr[index]+=thumbnails.eq(i).outerHeight(true);

					}
				}
			}

			/**
			 * 最小值下标
			 */
			function getMinhIndex (hArr,val) {
				for(var i in hArr){
					if (hArr[i] == val) {
						return i;
					}
				}
			}

			function checkScrollSlide () {
				//获取所有 ‘thumbnail’ 元素
				var thumbnails = $("#falls").find('div[class="thumbnail"]');
				//最后一张图 高度
				var lastHDiv = thumbnails.eq(thumbnails.length-1)[0].offsetTop+Math.floor(thumbnails.eq(thumbnails.length-1).outerHeight(true)/2);
				//滚走的距离
				var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
				//获取浏览器可视区高度
				var height = $(window).height();
				console.log('滚动条：'+scrollTop+",浏览器可视区域："+height);
				return (lastHDiv < scrollTop + height) ? true : false;
			}

		});

	</script>
</body>
</html>